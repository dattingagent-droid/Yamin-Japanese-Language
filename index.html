<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Japanese Learning Platform</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      background: #000000;
    }
    
    * {
      box-sizing: border-box;
    }
    
    .video-container {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }
    
    .video-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    
    .gradient-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .gradient-accent {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    
    .gradient-success {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    .course-card {
      background: rgba(30, 30, 30, 0.95);
      border-radius: 24px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .course-card:active {
      transform: scale(0.98);
    }
    
    .lesson-item {
      background: rgba(30, 30, 30, 0.95);
      border-radius: 20px;
      transition: all 0.3s ease;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    .lesson-item:active {
      border-color: #667eea;
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.2);
      transform: translateX(8px);
    }
    
    .vip-badge {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      padding: 6px 16px;
      border-radius: 50px;
      color: white;
      font-size: 11px;
      font-weight: 800;
      letter-spacing: 0.5px;
      box-shadow: 0 4px 12px rgba(245, 87, 108, 0.4);
      text-transform: uppercase;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      transition: all 0.3s ease;
      box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
    }
    
    .btn-primary:active {
      transform: scale(0.96);
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }
    
    .toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 16px 32px;
      border-radius: 50px;
      z-index: 1000;
      animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5);
      font-weight: 700;
      font-size: 14px;
      max-width: 90%;
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translate(-50%, 40px);
      }
      to {
        opacity: 1;
        transform: translate(-50%, 0);
      }
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    
    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      z-index: 999;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn 0.3s ease;
    }
    
    .modal-content {
      background: #1a1a1a;
      border-radius: 28px;
      max-width: 500px;
      width: 100%;
      max-height: 90%;
      overflow-y: auto;
      box-shadow: 0 30px 60px rgba(0,0,0,0.5);
      animation: scaleIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(20, 20, 20, 0.98);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-top: 1px solid rgba(255,255,255,0.1);
      z-index: 50;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.5);
      padding-bottom: env(safe-area-inset-bottom);
    }
    
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #667eea !important;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15);
    }
    
    .floating-circle {
      position: absolute;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.05);
      filter: blur(60px);
      pointer-events: none;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="h-full w-full" style="background: #000000;"></div>
  <script type="module">
    // ============================================
    // FIREBASE INITIALIZATION
    // ============================================
    const firebaseConfig = {
      apiKey: "AIzaSyAE2Qdp_I3y2OTKVhQqe7TvMoK4hmzjz3Y",
      authDomain: "dgms-2d3a1.firebaseapp.com",
      databaseURL: "https://dgms-2d3a1-default-rtdb.firebaseio.com",
      projectId: "dgms-2d3a1",
      storageBucket: "dgms-2d3a1.appspot.com",
      messagingSenderId: "260829624827",
      appId: "1:260829624827:web:80b17663aa487eeae8335e"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();
    const storage = firebase.storage();

    // ============================================
    // GLOBAL STATE
    // ============================================
    let currentUser = null;
    let allCourses = [];
    let allVideos = [];
    let allUsers = [];
    let allVipKeys = [];

    const ADMIN_PASSWORD = "295801";

    let appState = {
      currentUser: null,
      currentPage: 'login',
      selectedCourse: null,
      selectedVideo: null,
      language: 'en',
      isLoading: false,
      keyFilter: 'all',
      navigationHistory: []
    };

    // ============================================
    // BROWSER HISTORY MANAGEMENT
    // ============================================
    function pushHistoryState(page, data = {}) {
      const state = { page, ...data };
      history.pushState(state, '', `#${page}`);
      appState.navigationHistory.push(state);
    }

    function handlePopState(event) {
      if (event.state) {
        // Restore state from history
        appState.currentPage = event.state.page;
        appState.selectedCourse = event.state.selectedCourse || null;
        appState.selectedVideo = event.state.selectedVideo || null;
        
        // Remove last item from navigation history
        if (appState.navigationHistory.length > 0) {
          appState.navigationHistory.pop();
        }
        
        render();
      } else {
        // No state, go to default page based on login status
        if (appState.currentUser) {
          appState.currentPage = 'courses';
        } else {
          appState.currentPage = 'login';
        }
        render();
      }
    }

    // Listen for browser back/forward button
    window.addEventListener('popstate', handlePopState);

    // ============================================
    // CONFIG MANAGEMENT
    // ============================================
    const defaultConfig = {
      site_title: "ğŸŒ æ—¥æœ¬èªã‚¯ãƒ©ã‚¹",
      tagline: "Master Japanese Language",
      welcome_message: "ã“ã‚“ã«ã¡ã¯ï¼",
      vip_cta_text: "ğŸŒ¸ Unlock Premium",
      primary_color: "#667eea",
      secondary_color: "#ffffff",
      text_color: "#e2e8f0",
      accent_color: "#f5576c",
      background_color: "#000000",
      font_family: "system-ui",
      font_size: 16
    };

    let config = { ...defaultConfig };

    // ============================================
    // FIREBASE DATA LISTENERS
    // ============================================
    db.ref('courses').on('value', (snapshot) => {
      allCourses = [];
      snapshot.forEach((child) => {
        allCourses.push({ id: child.key, ...child.val() });
      });
      // Only render if app is already initialized
      if (document.getElementById('app') && appState.currentUser) {
        render();
      }
    });

    db.ref('videos').on('value', (snapshot) => {
      allVideos = [];
      snapshot.forEach((child) => {
        allVideos.push({ id: child.key, ...child.val() });
      });
      // Only render if app is already initialized
      if (document.getElementById('app') && appState.currentUser) {
        render();
      }
    });

    db.ref('users').on('value', (snapshot) => {
      allUsers = [];
      snapshot.forEach((child) => {
        allUsers.push({ id: child.key, ...child.val() });
      });
      // Only render if app is already initialized
      if (document.getElementById('app') && appState.currentUser) {
        render();
      }
    });

    db.ref('vipKeys').on('value', (snapshot) => {
      allVipKeys = [];
      snapshot.forEach((child) => {
        allVipKeys.push({ id: child.key, ...child.val() });
      });
      // Only render if app is already initialized
      if (document.getElementById('app') && appState.currentUser) {
        render();
      }
    });

    // ============================================
    // UTILITY FUNCTIONS
    // ============================================
    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    function generateVipKey() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      const part1 = Array.from({length: 4}, () => chars[Math.floor(Math.random() * chars.length)]).join('');
      const part2 = Array.from({length: 4}, () => chars[Math.floor(Math.random() * chars.length)]).join('');
      return `VIP-${part1}-${part2}`;
    }

    function getUserRole() {
      return currentUser?.role || 'user';
    }

    function canAccessVideo(video) {
      const role = getUserRole();
      if (role === 'admin') return true;
      if (role === 'vip') return true;
      return !video.isVIP;
    }

    function t(key, enText, mmText) {
      return appState.language === 'mm' ? mmText : enText;
    }

    // ============================================
    // AUTHENTICATION FUNCTIONS
    // ============================================
    async function handleLogin(email, password) {
      appState.isLoading = true;
      render();
      
      try {
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        const userSnapshot = await db.ref(`users/${userCredential.user.uid}`).once('value');
        currentUser = { id: userCredential.user.uid, ...userSnapshot.val() };
        appState.currentUser = currentUser;
        appState.currentPage = 'courses';
        pushHistoryState('courses');
        showToast(t('login_success', 'âœ¨ Welcome back!', 'âœ¨ á€•á€¼á€”á€ºá€œá€Šá€ºá€€á€¼á€­á€¯á€†á€­á€¯á€•á€«á€á€Šá€º!'));
      } catch (error) {
        showToast(t('login_error', 'âŒ Invalid credentials', 'âŒ á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€™á€»á€¬á€¸á€™á€¾á€¬á€¸á€šá€½á€„á€ºá€¸á€”á€±á€•á€«á€á€Šá€º'));
      }
      
      appState.isLoading = false;
      render();
    }

    async function handleRegister(email, password, name) {
      appState.isLoading = true;
      render();
      
      try {
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const newUser = {
          email,
          name,
          role: 'user',
          createdAt: Date.now()
        };
        await db.ref(`users/${userCredential.user.uid}`).set(newUser);
        currentUser = { id: userCredential.user.uid, ...newUser };
        appState.currentUser = currentUser;
        appState.currentPage = 'courses';
        pushHistoryState('courses');
        showToast(t('register_success', 'ğŸ‰ Account created!', 'ğŸ‰ á€¡á€€á€±á€¬á€„á€·á€ºá€–á€½á€„á€·á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®!'));
      } catch (error) {
        showToast(t('email_exists', 'âŒ Email already exists', 'âŒ á€¡á€®á€¸á€™á€±á€¸á€œá€ºá€›á€¾á€­á€•á€¼á€®á€¸á€á€¬á€¸á€–á€¼á€…á€ºá€•á€«á€á€Šá€º'));
      }
      
      appState.isLoading = false;
      render();
    }

    async function handleAdminLogin(password) {
      appState.isLoading = true;
      render();
      
      await new Promise(resolve => setTimeout(resolve, 500));
      
      if (password === ADMIN_PASSWORD) {
        const adminUser = {
          id: 'admin',
          email: 'admin@japaneseclass.com',
          name: 'Admin',
          role: 'admin'
        };
        currentUser = adminUser;
        appState.currentUser = adminUser;
        appState.currentPage = 'admin';
        pushHistoryState('admin');
        showToast(t('admin_login', 'ğŸ‘‘ Admin access granted', 'ğŸ‘‘ Admin á€¡á€–á€¼á€…á€ºá€á€„á€ºá€›á€±á€¬á€€á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®'));
      } else {
        showToast(t('admin_error', 'âŒ Invalid password', 'âŒ Admin á€…á€€á€¬á€¸á€á€¾á€€á€ºá€™á€¾á€¬á€¸á€šá€½á€„á€ºá€¸á€”á€±á€•á€«á€á€Šá€º'));
      }
      
      appState.isLoading = false;
      render();
    }

    function handleLogout() {
      auth.signOut();
      currentUser = null;
      appState.currentUser = null;
      appState.currentPage = 'login';
      appState.navigationHistory = [];
      // Clear history and reset to login
      history.replaceState({ page: 'login' }, '', '#login');
      showToast(t('logout', 'ğŸ‘‹ Logged out', 'ğŸ‘‹ á€‘á€½á€€á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®'));
      render();
    }

    // ============================================
    // VIP KEY FUNCTIONS
    // ============================================
    async function handleActivateVipKey(keyCode) {
      appState.isLoading = true;
      render();
      
      await new Promise(resolve => setTimeout(resolve, 500));
      
      const keySnapshot = await db.ref('vipKeys').orderByChild('keyCode').equalTo(keyCode).once('value');
      
      if (!keySnapshot.exists()) {
        showToast(t('key_invalid', 'âŒ Invalid VIP key', 'âŒ VIP key á€™á€¾á€¬á€¸á€šá€½á€„á€ºá€¸á€”á€±á€•á€«á€á€Šá€º'));
        appState.isLoading = false;
        render();
        return;
      }
      
      let keyData = null;
      let keyId = null;
      keySnapshot.forEach((child) => {
        keyData = child.val();
        keyId = child.key;
      });
      
      if (keyData.isUsed) {
        showToast(t('key_used', 'âŒ Key already used', 'âŒ Key á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€•á€¼á€®á€¸á€á€¬á€¸á€–á€¼á€…á€ºá€•á€«á€á€Šá€º'));
        appState.isLoading = false;
        render();
        return;
      }
      
      if (keyData.expiredAt && Date.now() > keyData.expiredAt) {
        showToast(t('key_expired', 'âŒ Key expired', 'âŒ Key á€á€€á€ºá€á€™á€ºá€¸á€€á€¯á€”á€ºá€†á€¯á€¶á€¸á€•á€¼á€®á€¸á€–á€¼á€…á€ºá€•á€«á€á€Šá€º'));
        appState.isLoading = false;
        render();
        return;
      }
      
      await db.ref(`vipKeys/${keyId}`).update({
        isUsed: true,
        usedBy: currentUser.id,
        usedAt: Date.now()
      });
      
      await db.ref(`users/${currentUser.id}`).update({
        role: 'vip',
        vipActivatedAt: Date.now()
      });
      
      currentUser.role = 'vip';
      currentUser.vipActivatedAt = Date.now();
      appState.currentUser = currentUser;
      
      // Navigate back to courses
      history.back();
      
      showToast(t('vip_activated', 'ğŸŒ¸ VIP activated!', 'ğŸŒ¸ VIP á€¡á€á€½á€„á€·á€ºá€¡á€›á€±á€¸á€›á€›á€¾á€­á€•á€¼á€®á€¸á€•á€¼á€®!'));
      
      appState.isLoading = false;
      render();
    }

    function handleGenerateVipKey(duration) {
      const keyCode = generateVipKey();
      const newKey = {
        keyCode,
        isUsed: false,
        usedBy: null,
        createdAt: Date.now(),
        expiredAt: duration === 'lifetime' ? null : Date.now() + (duration === '7days' ? 7 : 30) * 24 * 60 * 60 * 1000
      };
      
      db.ref('vipKeys').push(newKey);
      showToast(`âœ¨ Key generated: ${keyCode}`);
    }

    // ============================================
    // UI RENDER FUNCTIONS
    // ============================================
    function renderLoginPage() {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;
      
      return `
        <div class="min-h-full flex flex-col gradient-primary relative overflow-hidden" style="font-family: ${customFont}, ${baseFontStack};">
          <!-- Floating Decorative Circles -->
          <div class="floating-circle" style="width: 300px; height: 300px; top: -100px; right: -100px;"></div>
          <div class="floating-circle" style="width: 250px; height: 250px; bottom: -80px; left: -80px;"></div>
          <div class="floating-circle" style="width: 150px; height: 150px; top: 40%; left: 20%;"></div>

          <!-- Language Toggle -->
          <div class="p-5 flex justify-end relative z-10">
            <button onclick="window.toggleLanguage()" class="glass-card px-5 py-2.5 rounded-full font-bold shadow-lg" style="font-size: ${baseSize * 0.875}px; color: #667eea;">
              ${appState.language === 'en' ? 'ğŸ‡²ğŸ‡² á€™á€¼á€”á€ºá€™á€¬' : 'ğŸ‡¬ğŸ‡§ English'}
            </button>
          </div>

          <!-- Header with Animation -->
          <div class="px-6 text-center relative z-10 flex-1 flex flex-col justify-center">
            <div class="mb-6">
              <div class="text-8xl mb-4" style="animation: bounce 2s infinite;">ğŸŒ</div>
              <h1 class="font-bold mb-3 text-white" style="font-size: ${baseSize * 2.25}px; text-shadow: 0 4px 20px rgba(0,0,0,0.2); letter-spacing: -0.5px;">
                ${config.site_title || defaultConfig.site_title}
              </h1>
              <p class="text-white font-medium" style="font-size: ${baseSize * 1.125}px; opacity: 0.95;">
                ${config.tagline || defaultConfig.tagline}
              </p>
            </div>
          </div>

          <!-- Login Form Card -->
          <div class="px-5 pb-8 relative z-10">
            <div class="glass-card p-8 rounded-3xl shadow-2xl" style="max-width: 400px; margin: 0 auto;">
              <h2 class="font-bold mb-6 text-center" style="font-size: ${baseSize * 1.5}px; color: #2d3748;">
                ${t('login_title', 'ğŸ”“ Welcome Back', 'ğŸ”“ á€•á€¼á€”á€ºá€œá€Šá€ºá€€á€¼á€­á€¯á€†á€­á€¯á€•á€«á€á€Šá€º')}
              </h2>
              
              <form id="loginForm" class="space-y-5">
                <div>
                  <label class="block mb-2.5 font-bold" style="font-size: ${baseSize * 0.875}px; color: #4a5568;" for="loginEmail">
                    ${t('email', 'ğŸ“§ Email Address', 'ğŸ“§ á€¡á€®á€¸á€™á€±á€¸á€œá€º')}
                  </label>
                  <input type="email" id="loginEmail" required class="w-full p-4 rounded-2xl border-2 transition-all" style="font-size: ${baseSize}px; border-color: #e2e8f0; background: white;" placeholder="your@email.com" />
                </div>
                
                <div>
                  <label class="block mb-2.5 font-bold" style="font-size: ${baseSize * 0.875}px; color: #4a5568;" for="loginPassword">
                    ${t('password', 'ğŸ”‘ Password', 'ğŸ”‘ á€…á€€á€¬á€¸á€á€¾á€€á€º')}
                  </label>
                  <input type="password" id="loginPassword" required class="w-full p-4 rounded-2xl border-2 transition-all" style="font-size: ${baseSize}px; border-color: #e2e8f0; background: white;" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
                </div>
                
                <button type="submit" class="w-full p-4 rounded-2xl font-bold text-white btn-primary" style="font-size: ${baseSize * 1.125}px;" ${appState.isLoading ? 'disabled' : ''}>
                  ${appState.isLoading ? 'â³ ' + t('loading', 'Loading...', 'á€á€„á€ºá€”á€±á€á€Šá€º...') : 'âœ¨ ' + t('login_btn', 'Sign In', 'á€á€„á€ºá€›á€±á€¬á€€á€ºá€™á€Šá€º')}
                </button>
              </form>
              
              <div class="mt-6 text-center">
                <button onclick="window.showRegister()" class="font-bold" style="font-size: ${baseSize * 0.875}px; color: #667eea;">
                  ${t('no_account', "âœ¨ Create New Account", 'âœ¨ á€¡á€€á€±á€¬á€„á€·á€ºá€¡á€á€…á€ºá€–á€½á€„á€·á€ºá€™á€Šá€º')}
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderRegisterPage() {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;
      
      return `
        <div class="min-h-full gradient-primary" style="font-family: ${customFont}, ${baseFontStack};">
          <div class="p-5 flex items-center glass-card">
            <button onclick="window.goBack()" class="mr-4 w-10 h-10 rounded-full flex items-center justify-center" style="background: rgba(255,255,255,0.3); color: white; font-size: 24px;">â†</button>
            <h1 class="font-bold text-white" style="font-size: ${baseSize * 1.5}px;">
              ${t('register_title', 'Create Account', 'á€¡á€€á€±á€¬á€„á€·á€ºá€–á€½á€„á€·á€ºá€›á€”á€º')}
            </h1>
          </div>
          
          <div class="p-5">
            <div class="glass-card p-8 rounded-3xl shadow-2xl" style="max-width: 400px; margin: 0 auto;">
              <form id="registerForm" class="space-y-5">
                <div>
                  <label class="block mb-2.5 font-bold" style="font-size: ${baseSize * 0.875}px; color: #4a5568;" for="registerName">
                    ${t('name', 'ğŸ‘¤ Full Name', 'ğŸ‘¤ á€”á€¬á€™á€Šá€º')}
                  </label>
                  <input type="text" id="registerName" required class="w-full p-4 rounded-2xl border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0;" placeholder="${t('name_placeholder', 'Your name', 'á€á€„á€·á€ºá€”á€¬á€™á€Šá€º')}" />
                </div>
                
                <div>
                  <label class="block mb-2.5 font-bold" style="font-size: ${baseSize * 0.875}px; color: #4a5568;" for="registerEmail">
                    ${t('email', 'ğŸ“§ Email Address', 'ğŸ“§ á€¡á€®á€¸á€™á€±á€¸á€œá€º')}
                  </label>
                  <input type="email" id="registerEmail" required class="w-full p-4 rounded-2xl border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0;" placeholder="your@email.com" />
                </div>
                
                <div>
                  <label class="block mb-2.5 font-bold" style="font-size: ${baseSize * 0.875}px; color: #4a5568;" for="registerPassword">
                    ${t('password', 'ğŸ”‘ Password', 'ğŸ”‘ á€…á€€á€¬á€¸á€á€¾á€€á€º')}
                  </label>
                  <input type="password" id="registerPassword" required class="w-full p-4 rounded-2xl border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0;" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
                </div>
                
                <button type="submit" class="w-full p-4 rounded-2xl font-bold text-white btn-primary" style="font-size: ${baseSize * 1.125}px;" ${appState.isLoading ? 'disabled' : ''}>
                  ${appState.isLoading ? 'â³ ' + t('loading', 'Loading...', 'á€á€„á€ºá€”á€±á€á€Šá€º...') : 'ğŸ‰ ' + t('register_btn', 'Create Account', 'á€¡á€€á€±á€¬á€„á€·á€ºá€–á€½á€„á€·á€ºá€™á€Šá€º')}
                </button>
              </form>
            </div>
          </div>
        </div>
      `;
    }

    function renderCoursesPage() {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;
      const role = getUserRole();
      
      return `
        <div class="pb-28" style="font-family: ${customFont}, ${baseFontStack}; background: #000000; min-height: 100%;">
          <!-- Modern Header with Gradient -->
          <div class="gradient-primary p-6 rounded-b-3xl shadow-2xl relative overflow-hidden">
            <div class="floating-circle" style="width: 150px; height: 150px; top: -50px; right: -50px;"></div>
            <div class="floating-circle" style="width: 100px; height: 100px; bottom: -30px; left: -30px;"></div>
            
            <div class="flex items-center justify-between mb-5 relative z-10">
              <div class="flex-1">
                <h1 class="font-bold text-white mb-1.5" style="font-size: ${baseSize * 1.875}px; text-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                  ${config.welcome_message || defaultConfig.welcome_message}
                </h1>
                <div class="flex items-center gap-2.5">
                  <p class="text-white font-medium" style="font-size: ${baseSize}px; opacity: 0.95;">
                    ${currentUser?.name || 'Guest'}
                  </p>
                  ${role === 'vip' ? '<span class="vip-badge">â­ VIP</span>' : role === 'admin' ? '<span class="px-3 py-1.5 bg-purple-500 rounded-full text-white text-xs font-bold shadow-lg">ğŸ‘‘ Admin</span>' : ''}
                </div>
              </div>
              <div class="flex gap-2.5">
                <button onclick="window.showUserProfile()" class="w-12 h-12 rounded-2xl glass-card flex items-center justify-center shadow-lg">
                  <span class="text-2xl">ğŸ‘¤</span>
                </button>
                <button onclick="window.toggleLanguage()" class="px-4 py-2.5 rounded-2xl glass-card font-bold shadow-lg" style="color: #667eea; font-size: ${baseSize * 0.875}px;">
                  ${appState.language === 'en' ? 'ğŸ‡²ğŸ‡²' : 'ğŸ‡¬ğŸ‡§'}
                </button>
              </div>
            </div>
          </div>

          <!-- VIP Upgrade Banner -->
          ${role === 'user' ? `
            <div class="mx-5 mt-6 p-6 rounded-3xl gradient-accent shadow-xl course-card" onclick="window.navigateTo('vipkey')" style="cursor: pointer;">
              <div class="flex items-center">
                <div class="flex-shrink-0 w-16 h-16 rounded-2xl bg-white flex items-center justify-center text-4xl mr-4 shadow-lg">
                  ğŸŒ¸
                </div>
                <div class="flex-1">
                  <p class="font-bold mb-1 text-white" style="font-size: ${baseSize * 1.25}px;">
                    ${config.vip_cta_text || defaultConfig.vip_cta_text}
                  </p>
                  <p class="text-white font-medium" style="font-size: ${baseSize * 0.875}px; opacity: 0.95;">
                    ${t('vip_desc', 'Unlock all premium lessons', 'Premium á€á€„á€ºá€á€”á€ºá€¸á€…á€¬á€¡á€¬á€¸á€œá€¯á€¶á€¸')}
                  </p>
                </div>
                <div class="text-white text-3xl font-bold">â†’</div>
              </div>
            </div>
          ` : ''}

          <!-- Courses Section -->
          <div class="p-5 mt-6">
            <div class="flex items-center justify-between mb-5">
              <h2 class="font-bold" style="font-size: ${baseSize * 1.625}px; color: #e2e8f0;">
                ${t('all_courses', 'ğŸ“š Courses', 'ğŸ“š á€á€„á€ºá€á€”á€ºá€¸á€…á€¬á€™á€»á€¬á€¸')}
              </h2>
              <span class="px-4 py-2 rounded-full font-bold" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-size: ${baseSize * 0.875}px; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                ${allCourses.length}
              </span>
            </div>
            
            <div class="space-y-5">
              ${allCourses.map(course => `
                <div class="course-card" onclick="window.selectCourse('${course.id}')" style="cursor: pointer;">
                  <div class="flex items-center p-5">
                    <div class="flex-shrink-0 w-24 h-24 rounded-3xl flex items-center justify-center text-5xl mr-5 shadow-lg overflow-hidden border-2" style="background: #1a1a1a; border-color: rgba(255,255,255,0.1); padding: 0;">
                      ${course.thumbnailUrl ? `<img src="${course.thumbnailUrl}" alt="${course.title}" class="w-full h-full object-cover" onerror="this.style.display='none'; this.parentElement.innerHTML='<span style=\\'font-size: 3rem;\\'>${course.thumbnail || 'ğŸ“š'}</span>';" />` : `<span style="padding: 20px;">${course.thumbnail || 'ğŸ“š'}</span>`}
                    </div>
                    <div class="flex-1">
                      <div class="flex items-start justify-between mb-2">
                        <h3 class="font-bold flex-1" style="font-size: ${baseSize * 1.25}px; color: #e2e8f0; line-height: 1.3;">
                          ${appState.language === 'mm' ? course.titleMM : course.title}
                        </h3>
                        ${course.isVIP ? '<span class="vip-badge ml-2">VIP</span>' : ''}
                      </div>
                      <p style="font-size: ${baseSize * 0.875}px; color: #94a3b8; line-height: 1.6; margin-bottom: 10px;">
                        ${appState.language === 'mm' ? course.descriptionMM : course.description}
                      </p>
                      ${course.isVIP && role === 'user' ? `
                        <div class="flex items-center gap-2">
                          <span style="font-size: ${baseSize * 0.8125}px; color: #f5576c; font-weight: 700;">ğŸ”’ ${t('vip_required', 'VIP Required', 'VIP á€œá€­á€¯á€¡á€•á€ºá€á€Šá€º')}</span>
                        </div>
                      ` : `
                        <div class="flex items-center gap-2 font-bold" style="color: #667eea; font-size: ${baseSize * 0.9375}px;">
                          <span>${t('view_lessons', 'Start Learning', 'á€…á€á€„á€ºá€œá€±á€·á€œá€¬á€™á€Šá€º')}</span>
                          <span>â†’</span>
                        </div>
                      `}
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>

          ${renderBottomNav()}
        </div>
      `;
    }

    function renderCourseDetailPage() {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;
      const course = allCourses.find(c => c.id === appState.selectedCourse);
      const videos = allVideos.filter(v => v.courseId === course.id);
      const role = getUserRole();
      
      return `
        <div class="pb-28" style="font-family: ${customFont}, ${baseFontStack}; background: #000000; min-height: 100%;">
          <!-- Header -->
          <div class="gradient-primary p-5 flex items-center shadow-xl">
            <button onclick="window.goBack()" class="mr-4 w-10 h-10 rounded-full glass-card flex items-center justify-center" style="color: white; font-size: 24px;">â†</button>
            <div class="flex-1">
              <h1 class="font-bold text-white" style="font-size: ${baseSize * 1.375}px;">
                ${appState.language === 'mm' ? course.titleMM : course.title}
              </h1>
            </div>
          </div>

          <!-- Course Info Card -->
          <div class="p-5">
            <div class="glass-card p-8 rounded-3xl mb-6 shadow-xl text-center">
              <div class="w-32 h-32 mx-auto mb-5 rounded-3xl shadow-lg overflow-hidden flex items-center justify-center border-2" style="background: #1a1a1a; border-color: rgba(255,255,255,0.1);">
                ${course.thumbnailUrl ? `
                  <img src="${course.thumbnailUrl}" alt="${course.title}" class="w-full h-full object-cover" onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\\'font-size: 4rem; padding: 20px;\\'>${course.thumbnail || 'ğŸ“š'}</div>';" />
                ` : `
                  <div style="font-size: 4rem; padding: 20px;">${course.thumbnail || 'ğŸ“š'}</div>
                `}
              </div>
              <p style="font-size: ${baseSize}px; color: #4a5568; line-height: 1.7;">
                ${appState.language === 'mm' ? course.descriptionMM : course.description}
              </p>
            </div>

            <!-- Lessons List -->
            <h2 class="font-bold mb-5" style="font-size: ${baseSize * 1.5}px; color: #e2e8f0;">
              ${t('lessons', 'ğŸ“– Lessons', 'ğŸ“– á€á€„á€ºá€á€”á€ºá€¸á€…á€¬á€™á€»á€¬á€¸')} (${videos.length})
            </h2>
            
            <div class="space-y-4">
              ${videos.map((video, index) => {
                const canAccess = canAccessVideo(video);
                return `
                  <div class="lesson-item p-5 ${canAccess ? 'cursor-pointer' : ''}" ${canAccess ? `onclick="window.selectVideo('${video.id}')"` : ''} style="${!canAccess ? 'opacity: 0.6;' : ''}">
                    <div class="flex items-center">
                      <div class="w-14 h-14 rounded-2xl flex items-center justify-center mr-4 gradient-primary shadow-lg">
                        <span class="font-bold text-white" style="font-size: ${baseSize * 1.375}px;">${index + 1}</span>
                      </div>
                      <div class="flex-1">
                        <h3 class="font-bold mb-1" style="font-size: ${baseSize * 1.0625}px; color: #e2e8f0;">
                          ${appState.language === 'mm' ? video.titleMM : video.title}
                        </h3>
                        <p style="font-size: ${baseSize * 0.875}px; color: #94a3b8;">
                          â±ï¸ ${video.duration}
                        </p>
                      </div>
                      ${video.isVIP && role === 'user' ? `
                        <div class="ml-3 w-10 h-10 rounded-full bg-pink-100 flex items-center justify-center">
                          <span class="text-2xl">ğŸ”’</span>
                        </div>
                      ` : `
                        <div class="ml-3 w-10 h-10 rounded-full flex items-center justify-center" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                          <span class="text-white text-xl">â–¶</span>
                        </div>
                      `}
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>

          ${renderBottomNav()}
        </div>
      `;
    }

    function renderVideoPlayerPage() {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;
      const video = allVideos.find(v => v.id === appState.selectedVideo);
      const course = allCourses.find(c => c.id === video.courseId);
      
      return `
        <div class="pb-28" style="font-family: ${customFont}, ${baseFontStack}; background: #000000; min-height: 100%;">
          <!-- Header -->
          <div class="p-5 flex items-center" style="background: rgba(0,0,0,0.5);">
            <button onclick="window.goBack()" class="mr-4 w-10 h-10 rounded-full glass-card flex items-center justify-center" style="color: white; font-size: 24px;">â†</button>
            <div class="flex-1">
              <h1 class="font-bold text-white" style="font-size: ${baseSize * 1.125}px;">
                ${appState.language === 'mm' ? video.titleMM : video.title}
              </h1>
            </div>
          </div>

          <!-- Video Player -->
          <div class="p-5">
            <div class="video-container" style="background: #000;">
              ${video.videoUrl ? `
                <video controls style="width: 100%; height: 100%; position: absolute; top: 0; left: 0;">
                  <source src="${video.videoUrl}" type="video/mp4">
                  Your browser does not support the video tag.
                </video>
              ` : `
                <div class="absolute inset-0 flex items-center justify-center">
                  <div class="text-center text-white">
                    <div class="text-7xl mb-6">ğŸ¬</div>
                    <p class="font-bold mb-2" style="font-size: ${baseSize * 1.25}px;">No Video Available</p>
                    <p style="font-size: ${baseSize}px; opacity: 0.7;">Video has not been uploaded yet</p>
                  </div>
                </div>
              `}
            </div>

            <!-- Video Info Card -->
            <div class="mt-6 glass-card p-6 rounded-3xl shadow-xl">
              <h2 class="font-bold mb-3" style="font-size: ${baseSize * 1.375}px; color: #2d3748;">
                ${appState.language === 'mm' ? video.titleMM : video.title}
              </h2>
              <p class="mb-2" style="font-size: ${baseSize * 0.9375}px; color: #718096;">
                ğŸ“š ${t('course', 'Course', 'á€á€„á€ºá€á€”á€ºá€¸')}: <span class="font-bold">${appState.language === 'mm' ? course.titleMM : course.title}</span>
              </p>
              <p style="font-size: ${baseSize * 0.9375}px; color: #718096;">
                â±ï¸ ${t('duration', 'Duration', 'á€€á€¼á€¬á€á€»á€­á€”á€º')}: <span class="font-bold">${video.duration}</span>
              </p>
            </div>
          </div>

          ${renderBottomNav()}
        </div>
      `;
    }

    function renderVipKeyPage() {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;
      
      return `
        <div class="min-h-full pb-28" style="font-family: ${customFont}, ${baseFontStack}; background: #000000;">
          <!-- Header -->
          <div class="gradient-accent p-5 flex items-center shadow-2xl">
            <button onclick="window.goBack()" class="mr-4 w-10 h-10 rounded-full glass-card flex items-center justify-center" style="color: white; font-size: 24px;">â†</button>
            <h1 class="font-bold text-white" style="font-size: ${baseSize * 1.5}px;">
              ğŸŒ¸ ${t('activate_vip', 'VIP Access', 'VIP á€¡á€–á€½á€„á€·á€º')}
            </h1>
          </div>

          <div class="p-5">
            <!-- Benefits Card -->
            <div class="glass-card p-8 rounded-3xl mb-6 shadow-xl text-center">
              <div class="text-6xl mb-5">ğŸŒ</div>
              <h2 class="font-bold mb-5" style="font-size: ${baseSize * 1.5}px; color: #2d3748;">
                ${t('vip_benefits', 'Premium Benefits', 'Premium á€¡á€á€½á€„á€·á€ºá€‘á€°á€¸á€™á€»á€¬á€¸')}
              </h2>
              <div class="space-y-3 text-left">
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 rounded-full gradient-success flex items-center justify-center text-white font-bold">âœ“</div>
                  <p style="font-size: ${baseSize}px; color: #4a5568; font-weight: 600;">${t('benefit1', 'All premium courses', 'Premium á€á€„á€ºá€á€”á€ºá€¸á€…á€¬á€™á€»á€¬á€¸')}</p>
                </div>
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 rounded-full gradient-success flex items-center justify-center text-white font-bold">âœ“</div>
                  <p style="font-size: ${baseSize}px; color: #4a5568; font-weight: 600;">${t('benefit2', 'Exclusive content', 'á€¡á€‘á€°á€¸á€¡á€€á€¼á€±á€¬á€„á€ºá€¸á€¡á€›á€¬á€™á€»á€¬á€¸')}</p>
                </div>
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 rounded-full gradient-success flex items-center justify-center text-white font-bold">âœ“</div>
                  <p style="font-size: ${baseSize}px; color: #4a5568; font-weight: 600;">${t('benefit3', 'Lifetime access', 'á€á€…á€ºá€á€€á€ºá€œá€¯á€¶á€¸á€¡á€á€¯á€¶á€¸á€•á€¼á€¯á€á€½á€„á€·á€º')}</p>
                </div>
              </div>
            </div>

            <!-- Key Input Form -->
            <div class="glass-card p-8 rounded-3xl shadow-xl">
              <form id="vipKeyForm" class="space-y-5">
                <div>
                  <label class="block mb-3 font-bold text-center" style="font-size: ${baseSize * 1.125}px; color: #2d3748;" for="vipKeyInput">
                    ${t('enter_vip_key', 'ğŸŸï¸ Enter Your VIP Key', 'ğŸŸï¸ VIP Key á€‘á€Šá€·á€ºá€•á€«')}
                  </label>
                  <input type="text" id="vipKeyInput" required class="w-full p-5 rounded-2xl border-2 text-center font-mono font-bold" style="font-size: ${baseSize * 1.25}px; border-color: #667eea; letter-spacing: 2px;" placeholder="VIP-XXXX-YYYY" />
                </div>
                
                <button type="submit" class="w-full p-5 rounded-2xl font-bold text-white gradient-accent shadow-xl" style="font-size: ${baseSize * 1.125}px;" ${appState.isLoading ? 'disabled' : ''}>
                  ${appState.isLoading ? 'â³ ' + t('loading', 'Activating...', 'á€á€„á€ºá€”á€±á€á€Šá€º...') : 'ğŸŒ¸ ' + t('activate_btn', 'Activate VIP', 'VIP á€¡á€–á€½á€„á€·á€º')}
                </button>
              </form>
              
              <div class="mt-6 p-4 rounded-2xl" style="background: rgba(255,255,255,0.1);">
                <p class="text-center" style="font-size: ${baseSize * 0.875}px; color: #94a3b8; line-height: 1.6;">
                  ğŸ’¡ ${t('key_info', 'Contact admin to get VIP key', 'VIP key á€›á€šá€°á€›á€”á€º admin á€€á€­á€¯á€†á€€á€ºá€á€½á€šá€ºá€•á€«')}
                </p>
              </div>
            </div>
          </div>

          ${renderBottomNav()}
        </div>
      `;
    }

    function renderAdminPage() {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;
      
      return `
        <div class="pb-28" style="font-family: ${customFont}, ${baseFontStack}; background: #000000; min-height: 100%;">
          <!-- Header -->
          <div class="p-6" style="background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%); border-radius: 0 0 30px 30px; box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);">
            <div class="flex items-center justify-between">
              <div>
                <h1 class="font-bold text-white mb-1" style="font-size: ${baseSize * 1.875}px; text-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                  ğŸ‘‘ Admin Dashboard
                </h1>
                <p class="text-white font-medium" style="font-size: ${baseSize}px; opacity: 0.95;">
                  Manage your platform
                </p>
              </div>
              <button onclick="window.showAdminProfile()" class="w-12 h-12 rounded-2xl glass-card flex items-center justify-center shadow-lg">
                <span class="text-2xl">âš™ï¸</span>
              </button>
            </div>
          </div>

          <div class="p-5 space-y-6">
            <!-- Quick Actions Grid -->
            <div class="grid grid-cols-2 gap-4">
              <button onclick="window.showAddCourseModal()" class="glass-card p-6 rounded-3xl text-center shadow-lg course-card">
                <div class="text-5xl mb-3">â•</div>
                <p class="font-bold" style="font-size: ${baseSize * 0.9375}px; color: #2d3748;">Add Course</p>
              </button>
              <button onclick="window.showAddVideoModal()" class="glass-card p-6 rounded-3xl text-center shadow-lg course-card">
                <div class="text-5xl mb-3">ğŸ¬</div>
                <p class="font-bold" style="font-size: ${baseSize * 0.9375}px; color: #2d3748;">Add Video</p>
              </button>
              <button onclick="window.showKeyManagement()" class="glass-card p-6 rounded-3xl text-center shadow-lg course-card">
                <div class="text-5xl mb-3">ğŸŸï¸</div>
                <p class="font-bold" style="font-size: ${baseSize * 0.9375}px; color: #2d3748;">VIP Keys</p>
              </button>
              <button onclick="window.showUserManagement()" class="glass-card p-6 rounded-3xl text-center shadow-lg course-card">
                <div class="text-5xl mb-3">ğŸ‘¥</div>
                <p class="font-bold" style="font-size: ${baseSize * 0.9375}px; color: #2d3748;">Users</p>
              </button>
            </div>

            <!-- Stats Cards -->
            <div class="glass-card p-6 rounded-3xl shadow-xl">
              <h2 class="font-bold mb-5" style="font-size: ${baseSize * 1.375}px; color: #2d3748;">
                ğŸ“Š Platform Stats
              </h2>
              
              <div class="grid grid-cols-2 gap-4">
                <div class="text-center p-5 rounded-2xl" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);">
                  <p class="font-bold text-white mb-1" style="font-size: ${baseSize * 2}px;">
                    ${allCourses.length}
                  </p>
                  <p class="text-white font-medium" style="font-size: ${baseSize * 0.875}px; opacity: 0.95;">Courses</p>
                </div>
                <div class="text-center p-5 rounded-2xl" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); box-shadow: 0 4px 16px rgba(240, 147, 251, 0.3);">
                  <p class="font-bold text-white mb-1" style="font-size: ${baseSize * 2}px;">
                    ${allVideos.length}
                  </p>
                  <p class="text-white font-medium" style="font-size: ${baseSize * 0.875}px; opacity: 0.95;">Videos</p>
                </div>
                <div class="text-center p-5 rounded-2xl" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); box-shadow: 0 4px 16px rgba(79, 172, 254, 0.3);">
                  <p class="font-bold text-white mb-1" style="font-size: ${baseSize * 2}px;">
                    ${allUsers.filter(u => u.role === 'vip').length}
                  </p>
                  <p class="text-white font-medium" style="font-size: ${baseSize * 0.875}px; opacity: 0.95;">VIP Users</p>
                </div>
                <div class="text-center p-5 rounded-2xl" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); box-shadow: 0 4px 16px rgba(168, 237, 234, 0.3);">
                  <p class="font-bold mb-1" style="font-size: ${baseSize * 2}px; color: #667eea;">
                    ${allVipKeys.filter(k => !k.isUsed).length}
                  </p>
                  <p class="font-medium" style="font-size: ${baseSize * 0.875}px; color: #667eea; opacity: 0.8;">Active Keys</p>
                </div>
              </div>
            </div>

            <!-- Courses Management -->
            <div class="glass-card p-6 rounded-3xl shadow-xl">
              <div class="flex items-center justify-between mb-5">
                <h2 class="font-bold" style="font-size: ${baseSize * 1.375}px; color: #2d3748;">
                  ğŸ“š Courses (${allCourses.length})
                </h2>
                <button onclick="window.showAddCourseModal()" class="px-5 py-2.5 rounded-full font-bold text-white btn-primary" style="font-size: ${baseSize * 0.875}px;">
                  + Add
                </button>
              </div>
              
              <div class="space-y-3">
                ${allCourses.map(course => {
                  const courseVideos = allVideos.filter(v => v.courseId === course.id);
                  return `
                    <div class="p-4 rounded-2xl" style="background: rgba(255,255,255,0.05);">
                      <div class="flex items-start justify-between">
                        <div class="flex-1 flex items-start gap-3">
                          <div class="w-12 h-12 rounded-xl shadow-md flex-shrink-0 overflow-hidden flex items-center justify-center border" style="background: #1a1a1a; border-color: rgba(255,255,255,0.1); padding: 0;">
                            ${course.thumbnailUrl ? `
                              <img src="${course.thumbnailUrl}" alt="${course.title}" class="w-full h-full object-cover" onerror="this.style.display='none'; this.parentElement.innerHTML='<span style=\\'font-size: 1.875rem; padding: 8px;\\'>${course.thumbnail || 'ğŸ“š'}</span>';" />
                            ` : `
                              <span style="font-size: 1.875rem; padding: 8px;">${course.thumbnail || 'ğŸ“š'}</span>
                            `}
                          </div>
                          <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                              <h3 class="font-bold" style="font-size: ${baseSize * 1.0625}px; color: #e2e8f0;">
                                ${course.title}
                              </h3>
                              ${course.isVIP ? '<span class="vip-badge">VIP</span>' : ''}
                              <span class="px-3 py-1 bg-blue-100 rounded-full text-blue-700 text-xs font-bold">
                                ${courseVideos.length} videos
                              </span>
                            </div>
                            <p style="font-size: ${baseSize * 0.875}px; color: #94a3b8;">
                              ${course.description}
                            </p>
                          </div>
                        </div>
                        <div class="flex gap-2 ml-3">
                          <button onclick="window.editCourse('${course.id}')" class="w-10 h-10 rounded-full flex items-center justify-center btn-primary">
                            <span style="font-size: ${baseSize * 0.875}px;">âœï¸</span>
                          </button>
                          <button onclick="window.deleteCourse('${course.id}')" class="w-10 h-10 rounded-full flex items-center justify-center" style="background: #ef4444; color: white;">
                            <span style="font-size: ${baseSize * 0.875}px;">ğŸ—‘ï¸</span>
                          </button>
                        </div>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>

            <!-- Videos Management -->
            <div class="glass-card p-6 rounded-3xl shadow-xl">
              <div class="flex items-center justify-between mb-5">
                <h2 class="font-bold" style="font-size: ${baseSize * 1.375}px; color: #2d3748;">
                  ğŸ¬ Videos (${allVideos.length})
                </h2>
                <button onclick="window.showAddVideoModal()" class="px-5 py-2.5 rounded-full font-bold text-white btn-primary" style="font-size: ${baseSize * 0.875}px;">
                  + Add
                </button>
              </div>
              
              <div class="space-y-3">
                ${allVideos.length === 0 ? `
                  <div class="text-center py-8">
                    <div class="text-6xl mb-3">ğŸ¬</div>
                    <p style="font-size: ${baseSize}px; color: #718096;">
                      No videos yet. Add your first video!
                    </p>
                  </div>
                ` : allVideos.map(video => {
                  const videoCourse = allCourses.find(c => c.id === video.courseId);
                  return `
                    <div class="p-4 rounded-2xl" style="background: rgba(255,255,255,0.05);">
                      <div class="flex items-start justify-between">
                        <div class="flex-1">
                          <div class="flex items-center gap-2 mb-2">
                            <div class="w-10 h-10 rounded-xl gradient-primary flex items-center justify-center text-white font-bold">
                              â–¶
                            </div>
                            <div class="flex-1">
                              <h3 class="font-bold" style="font-size: ${baseSize * 1.0625}px; color: #e2e8f0;">
                                ${video.title}
                              </h3>
                              ${video.isVIP ? '<span class="vip-badge" style="display: inline-block; margin-top: 2px;">VIP</span>' : ''}
                            </div>
                          </div>
                          <div class="ml-12" style="font-size: ${baseSize * 0.875}px; color: #94a3b8;">
                            <p class="mb-1">
                              ğŸ“š Course: <span class="font-bold">${videoCourse ? videoCourse.title : 'Unknown'}</span>
                            </p>
                            <p class="mb-1">
                              â±ï¸ Duration: <span class="font-bold">${video.duration}</span>
                            </p>
                            ${video.videoUrl ? `
                              <p class="text-green-400 font-bold">
                                âœ… Video uploaded
                              </p>
                            ` : `
                              <p class="text-red-400 font-bold">
                                âŒ No video file
                              </p>
                            `}
                          </div>
                        </div>
                        <div class="flex gap-2 ml-3">
                          <button onclick="window.editVideo('${video.id}')" class="w-10 h-10 rounded-full flex items-center justify-center btn-primary">
                            <span style="font-size: ${baseSize * 0.875}px;">âœï¸</span>
                          </button>
                          <button onclick="window.deleteVideo('${video.id}')" class="w-10 h-10 rounded-full flex items-center justify-center" style="background: #ef4444; color: white;">
                            <span style="font-size: ${baseSize * 0.875}px;">ğŸ—‘ï¸</span>
                          </button>
                        </div>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
          </div>

          ${renderBottomNav()}
        </div>
      `;
    }

    function renderBottomNav() {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;
      const role = getUserRole();
      const currentPage = appState.currentPage;
      
      return `
        <div class="bottom-nav">
          <div class="flex items-center justify-around p-3">
            <button onclick="window.navigateTo('courses')" class="flex flex-col items-center p-2.5 rounded-2xl flex-1 transition-all" style="color: ${currentPage === 'courses' || currentPage === 'coursedetail' || currentPage === 'videoplayer' ? '#667eea' : '#94a3b8'}; ${currentPage === 'courses' || currentPage === 'coursedetail' || currentPage === 'videoplayer' ? 'background: rgba(102, 126, 234, 0.1);' : ''}">
              <span class="text-3xl mb-1">ğŸ“š</span>
              <span class="font-bold" style="font-size: ${baseSize * 0.75}px; font-family: ${customFont}, ${baseFontStack};">
                ${t('courses', 'Courses', 'á€á€„á€ºá€á€”á€ºá€¸á€…á€¬')}
              </span>
            </button>
            
            ${role === 'user' ? `
              <button onclick="window.navigateTo('vipkey')" class="flex flex-col items-center p-2.5 rounded-2xl flex-1 transition-all" style="color: ${currentPage === 'vipkey' ? '#f5576c' : '#94a3b8'}; ${currentPage === 'vipkey' ? 'background: rgba(245, 87, 108, 0.1);' : ''}">
                <span class="text-3xl mb-1">ğŸŒ¸</span>
                <span class="font-bold" style="font-size: ${baseSize * 0.75}px; font-family: ${customFont}, ${baseFontStack};">
                  ${t('vip', 'VIP', 'VIP')}
                </span>
              </button>
            ` : ''}
            
            ${role === 'admin' ? `
              <button onclick="window.navigateTo('admin')" class="flex flex-col items-center p-2.5 rounded-2xl flex-1 transition-all" style="color: ${currentPage === 'admin' ? '#8b5cf6' : '#94a3b8'}; ${currentPage === 'admin' ? 'background: rgba(139, 92, 246, 0.1);' : ''}">
                <span class="text-3xl mb-1">ğŸ‘‘</span>
                <span class="font-bold" style="font-size: ${baseSize * 0.75}px; font-family: ${customFont}, ${baseFontStack};">Admin</span>
              </button>
            ` : ''}
            
            <button onclick="window.showLogoutConfirm()" class="flex flex-col items-center p-2.5 rounded-2xl flex-1 transition-all" style="color: #94a3b8;">
              <span class="text-3xl mb-1">ğŸšª</span>
              <span class="font-bold" style="font-size: ${baseSize * 0.75}px; font-family: ${customFont}, ${baseFontStack};">
                ${t('logout', 'Logout', 'á€‘á€½á€€á€ºá€™á€Šá€º')}
              </span>
            </button>
          </div>
        </div>
      `;
    }

    // ============================================
    // MODAL RENDER FUNCTIONS
    // ============================================
    function renderAdminLoginModal() {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;
      
      return `
        <div class="modal-backdrop" onclick="if(event.target === this) window.closeModal()">
          <div class="modal-content" style="font-family: ${customFont}, ${baseFontStack};">
            <div class="p-8">
              <div class="flex items-center justify-between mb-6">
                <h2 class="font-bold" style="font-size: ${baseSize * 1.5}px; color: #e2e8f0;">
                  ğŸ‘‘ Admin Login
                </h2>
                <button onclick="window.closeModal()" class="w-10 h-10 rounded-full flex items-center justify-center" style="background: rgba(255,255,255,0.1); color: #94a3b8; font-size: 24px;">Ã—</button>
              </div>
              
              <form id="adminLoginForm" class="space-y-5">
                <div>
                  <label class="block mb-2.5 font-bold" style="font-size: ${baseSize * 0.875}px; color: #94a3b8;">
                    ğŸ”‘ Admin Password
                  </label>
                  <input type="password" id="adminPassword" required class="w-full p-4 rounded-2xl border-2" style="font-size: ${baseSize}px; border-color: rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e2e8f0;" placeholder="Enter admin password" />
                </div>
                
                <button type="submit" class="w-full p-4 rounded-2xl font-bold text-white btn-primary" style="font-size: ${baseSize * 1.125}px;" ${appState.isLoading ? 'disabled' : ''}>
                  ${appState.isLoading ? 'â³ Loading...' : 'ğŸ‘‘ Login as Admin'}
                </button>
              </form>
            </div>
          </div>
        </div>
      `;
    }

    function renderLogoutModal() {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;
      
      return `
        <div class="modal-backdrop" onclick="if(event.target === this) window.closeModal()">
          <div class="modal-content" style="font-family: ${customFont}, ${baseFontStack};">
            <div class="p-8 text-center">
              <div class="text-6xl mb-5">ğŸ‘‹</div>
              <h2 class="font-bold mb-3" style="font-size: ${baseSize * 1.5}px; color: #e2e8f0;">
                ${t('confirm_logout', 'Confirm Logout', 'á€‘á€½á€€á€ºá€™á€Šá€ºá€™á€¾á€¬ á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸')}
              </h2>
              <p class="mb-6" style="font-size: ${baseSize}px; color: #94a3b8;">
                ${t('logout_message', 'Are you sure you want to logout?', 'á€‘á€½á€€á€ºá€›á€”á€º á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸?')}
              </p>
              
              <div class="flex gap-3">
                <button onclick="window.closeModal()" class="flex-1 p-4 rounded-2xl font-bold border-2" style="font-size: ${baseSize}px; color: #94a3b8; border-color: rgba(255,255,255,0.1); background: rgba(255,255,255,0.05);">
                  ${t('cancel', 'Cancel', 'á€™á€œá€¯á€•á€ºá€á€±á€¬á€·á€•á€«')}
                </button>
                <button onclick="window.confirmLogout()" class="flex-1 p-4 rounded-2xl font-bold text-white" style="font-size: ${baseSize}px; background: #ef4444;">
                  ${t('logout', 'Logout', 'á€‘á€½á€€á€ºá€™á€Šá€º')}
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderUserProfileModal() {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;
      const role = getUserRole();
      
      return `
        <div class="modal-backdrop" onclick="if(event.target === this) window.closeModal()">
          <div class="modal-content" style="font-family: ${customFont}, ${baseFontStack};">
            <div class="p-8">
              <div class="flex items-center justify-between mb-6">
                <h2 class="font-bold" style="font-size: ${baseSize * 1.5}px; color: #e2e8f0;">
                  ğŸ‘¤ ${t('profile', 'Profile', 'á€€á€­á€¯á€šá€ºá€›á€±á€¸á€¡á€á€»á€€á€ºá€¡á€œá€€á€º')}
                </h2>
                <button onclick="window.closeModal()" class="w-10 h-10 rounded-full flex items-center justify-center" style="background: rgba(255,255,255,0.1); color: #94a3b8; font-size: 24px;">Ã—</button>
              </div>
              
              <div class="text-center mb-6">
                <div class="w-24 h-24 rounded-full gradient-primary flex items-center justify-center text-5xl mx-auto mb-4 shadow-xl">
                  ğŸ‘¤
                </div>
                <h3 class="font-bold mb-1" style="font-size: ${baseSize * 1.375}px; color: #e2e8f0;">
                  ${currentUser?.name || 'Guest'}
                </h3>
                <p class="mb-2" style="font-size: ${baseSize}px; color: #94a3b8;">
                  ${currentUser?.email || ''}
                </p>
                ${role === 'vip' ? `<span class="vip-badge">â­ VIP Member</span>` : 
                  role === 'admin' ? `<span class="px-4 py-2 bg-purple-500 rounded-full text-white text-sm font-bold">ğŸ‘‘ Administrator</span>` :
                  `<span class="px-4 py-2 rounded-full text-sm font-bold" style="background: rgba(255,255,255,0.1); color: #94a3b8;">ğŸ‘¤ Free Member</span>`}
              </div>
              
              <div class="space-y-3">
                <div class="p-4 rounded-2xl" style="background: rgba(255,255,255,0.05);">
                  <p class="font-bold mb-1" style="font-size: ${baseSize * 0.875}px; color: #94a3b8;">
                    ${t('account_type', 'Account Type', 'á€¡á€€á€±á€¬á€„á€·á€ºá€¡á€™á€»á€­á€¯á€¸á€¡á€…á€¬á€¸')}
                  </p>
                  <p class="font-bold" style="font-size: ${baseSize * 1.125}px; color: #e2e8f0;">
                    ${role === 'admin' ? 'ğŸ‘‘ Admin' : role === 'vip' ? 'â­ VIP' : 'ğŸ‘¤ Free'}
                  </p>
                </div>
                
                ${role === 'vip' && currentUser?.vipActivatedAt ? `
                  <div class="p-4 rounded-2xl" style="background: rgba(255,255,255,0.05);">
                    <p class="font-bold mb-1" style="font-size: ${baseSize * 0.875}px; color: #94a3b8;">
                      ${t('vip_since', 'VIP Since', 'VIP á€–á€¼á€…á€ºá€á€Šá€·á€ºá€›á€€á€º')}
                    </p>
                    <p class="font-bold" style="font-size: ${baseSize * 1.125}px; color: #e2e8f0;">
                      ${new Date(currentUser.vipActivatedAt).toLocaleDateString()}
                    </p>
                  </div>
                ` : ''}
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderKeyManagementModal() {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;
      
      const filteredKeys = appState.keyFilter === 'all' ? allVipKeys :
                           appState.keyFilter === 'used' ? allVipKeys.filter(k => k.isUsed) :
                           allVipKeys.filter(k => !k.isUsed);
      
      return `
        <div class="modal-backdrop" onclick="if(event.target === this) window.closeModal()">
          <div class="modal-content" style="font-family: ${customFont}, ${baseFontStack}; max-height: 90vh; overflow-y: auto;">
            <div class="p-8">
              <div class="flex items-center justify-between mb-6">
                <h2 class="font-bold" style="font-size: ${baseSize * 1.5}px; color: #e2e8f0;">
                  ğŸŸï¸ VIP Keys Management
                </h2>
                <button onclick="window.closeModal()" class="w-10 h-10 rounded-full flex items-center justify-center" style="background: rgba(255,255,255,0.1); color: #94a3b8; font-size: 24px;">Ã—</button>
              </div>
              
              <!-- Generate Keys -->
              <div class="mb-6 p-6 rounded-2xl" style="background: rgba(255,255,255,0.05);">
                <h3 class="font-bold mb-4" style="font-size: ${baseSize * 1.125}px; color: #e2e8f0;">
                  Generate New Key
                </h3>
                <div class="grid grid-cols-3 gap-3">
                  <button onclick="window.generateKey('7days')" class="p-3 rounded-xl font-bold text-white btn-primary" style="font-size: ${baseSize * 0.875}px;">
                    7 Days
                  </button>
                  <button onclick="window.generateKey('30days')" class="p-3 rounded-xl font-bold text-white btn-primary" style="font-size: ${baseSize * 0.875}px;">
                    30 Days
                  </button>
                  <button onclick="window.generateKey('lifetime')" class="p-3 rounded-xl font-bold text-white gradient-accent" style="font-size: ${baseSize * 0.875}px;">
                    Lifetime
                  </button>
                </div>
              </div>
              
              <!-- Filter Keys -->
              <div class="flex gap-2 mb-5">
                <button onclick="window.filterKeys('all')" class="flex-1 p-3 rounded-xl font-bold" style="font-size: ${baseSize * 0.875}px; ${appState.keyFilter === 'all' ? 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;' : 'background: rgba(255,255,255,0.05); color: #94a3b8;'}">
                  All (${allVipKeys.length})
                </button>
                <button onclick="window.filterKeys('unused')" class="flex-1 p-3 rounded-xl font-bold" style="font-size: ${baseSize * 0.875}px; ${appState.keyFilter === 'unused' ? 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;' : 'background: rgba(255,255,255,0.05); color: #94a3b8;'}">
                  Active (${allVipKeys.filter(k => !k.isUsed).length})
                </button>
                <button onclick="window.filterKeys('used')" class="flex-1 p-3 rounded-xl font-bold" style="font-size: ${baseSize * 0.875}px; ${appState.keyFilter === 'used' ? 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;' : 'background: rgba(255,255,255,0.05); color: #94a3b8;'}">
                  Used (${allVipKeys.filter(k => k.isUsed).length})
                </button>
              </div>
              
              <!-- Keys List -->
              <div class="space-y-3" style="max-height: 400px; overflow-y: auto;">
                ${filteredKeys.map(key => `
                  <div class="p-4 rounded-2xl border-2" style="border-color: ${key.isUsed ? 'rgba(255,255,255,0.1)' : '#667eea'}; background: rgba(255,255,255,0.05);">
                    <div class="flex items-start justify-between mb-2">
                      <code class="font-bold" style="font-size: ${baseSize}px; color: #e2e8f0;">
                        ${key.keyCode}
                      </code>
                      ${key.isUsed ? 
                        '<span class="px-3 py-1 rounded-full text-xs font-bold" style="background: rgba(255,255,255,0.1); color: #94a3b8;">Used</span>' :
                        '<span class="px-3 py-1 gradient-success rounded-full text-white text-xs font-bold">Active</span>'}
                    </div>
                    <div class="space-y-1" style="font-size: ${baseSize * 0.8125}px; color: #94a3b8;">
                      <p>ğŸ“… Created: ${new Date(key.createdAt).toLocaleDateString()}</p>
                      ${key.expiredAt ? `<p>â° Expires: ${new Date(key.expiredAt).toLocaleDateString()}</p>` : '<p>â° Lifetime</p>'}
                      ${key.isUsed ? `<p>ğŸ‘¤ Used by: User ${key.usedBy?.substring(0, 8)}...</p>` : ''}
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderUserManagementModal() {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;
      
      return `
        <div class="modal-backdrop" onclick="if(event.target === this) window.closeModal()">
          <div class="modal-content" style="font-family: ${customFont}, ${baseFontStack}; max-height: 90vh; overflow-y: auto;">
            <div class="p-8">
              <div class="flex items-center justify-between mb-6">
                <h2 class="font-bold" style="font-size: ${baseSize * 1.5}px; color: #e2e8f0;">
                  ğŸ‘¥ Users Management
                </h2>
                <button onclick="window.closeModal()" class="w-10 h-10 rounded-full flex items-center justify-center" style="background: rgba(255,255,255,0.1); color: #94a3b8; font-size: 24px;">Ã—</button>
              </div>
              
              <div class="space-y-3">
                ${allUsers.map(user => `
                  <div class="p-5 rounded-2xl" style="background: rgba(255,255,255,0.05);">
                    <div class="flex items-start justify-between mb-3">
                      <div class="flex-1">
                        <h3 class="font-bold mb-1" style="font-size: ${baseSize * 1.0625}px; color: #e2e8f0;">
                          ${user.name}
                        </h3>
                        <p style="font-size: ${baseSize * 0.875}px; color: #94a3b8;">
                          ${user.email}
                        </p>
                      </div>
                      ${user.role === 'vip' ? '<span class="vip-badge">VIP</span>' : '<span class="px-3 py-1 rounded-full text-xs font-bold" style="background: rgba(255,255,255,0.1); color: #94a3b8;">Free</span>'}
                    </div>
                    <div class="flex gap-2">
                      ${user.role === 'vip' ? `
                        <button onclick="window.revokeVIP('${user.id}')" class="flex-1 p-3 rounded-xl font-bold text-white" style="font-size: ${baseSize * 0.875}px; background: #ef4444;">
                          Revoke VIP
                        </button>
                      ` : `
                        <button onclick="window.grantVIP('${user.id}')" class="flex-1 p-3 rounded-xl font-bold text-white gradient-accent" style="font-size: ${baseSize * 0.875}px;">
                          Grant VIP
                        </button>
                      `}
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderAddCourseModal() {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;
      
      const editCourse = appState.editingCourse ? allCourses.find(c => c.id === appState.editingCourse) : null;
      
      return `
        <div class="modal-backdrop" onclick="if(event.target === this) window.closeModal()">
          <div class="modal-content" style="font-family: ${customFont}, ${baseFontStack};">
            <div class="p-8">
              <div class="flex items-center justify-between mb-6">
                <h2 class="font-bold" style="font-size: ${baseSize * 1.5}px; color: #e2e8f0;">
                  ${editCourse ? 'âœï¸ Edit Course' : 'â• Add New Course'}
                </h2>
                <button onclick="window.closeModal()" class="w-10 h-10 rounded-full flex items-center justify-center" style="background: rgba(255,255,255,0.1); color: #94a3b8; font-size: 24px;">Ã—</button>
              </div>
              
              <form id="addCourseForm" class="space-y-5">
                <div>
                  <label class="block mb-2 font-bold" style="font-size: ${baseSize * 0.875}px; color: #94a3b8;">
                    Title (English)
                  </label>
                  <input type="text" id="courseTitle" required class="w-full p-4 rounded-2xl border-2" style="font-size: ${baseSize}px; border-color: rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e2e8f0;" value="${editCourse?.title || ''}" />
                </div>
                
                <div>
                  <label class="block mb-2 font-bold" style="font-size: ${baseSize * 0.875}px; color: #94a3b8;">
                    Title (Myanmar)
                  </label>
                  <input type="text" id="courseTitleMM" required class="w-full p-4 rounded-2xl border-2" style="font-size: ${baseSize}px; border-color: rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e2e8f0;" value="${editCourse?.titleMM || ''}" />
                </div>
                
                <div>
                  <label class="block mb-2 font-bold" style="font-size: ${baseSize * 0.875}px; color: #94a3b8;">
                    Description (English)
                  </label>
                  <textarea id="courseDescription" required class="w-full p-4 rounded-2xl border-2" style="font-size: ${baseSize}px; border-color: rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e2e8f0; min-height: 80px;">${editCourse?.description || ''}</textarea>
                </div>
                
                <div>
                  <label class="block mb-2 font-bold" style="font-size: ${baseSize * 0.875}px; color: #94a3b8;">
                    Description (Myanmar)
                  </label>
                  <textarea id="courseDescriptionMM" required class="w-full p-4 rounded-2xl border-2" style="font-size: ${baseSize}px; border-color: rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e2e8f0; min-height: 80px;">${editCourse?.descriptionMM || ''}</textarea>
                </div>
                
                <div>
                  <label class="block mb-2 font-bold" style="font-size: ${baseSize * 0.875}px; color: #94a3b8;">
                    ğŸ“· Course Photo
                  </label>
                  
                  <input type="file" id="courseThumbnailPhoto" accept="image/*" class="w-full p-4 rounded-2xl border-2" style="font-size: ${baseSize}px; border-color: rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e2e8f0;" />
                  
                  ${editCourse?.thumbnailUrl ? `
                    <div class="mt-3 text-center p-4 rounded-2xl" style="background: rgba(255,255,255,0.05);">
                      <div class="w-32 h-32 mx-auto mb-3 rounded-2xl shadow-lg overflow-hidden border-2" style="background: #000; border-color: rgba(255,255,255,0.1);">
                        <img src="${editCourse.thumbnailUrl}" alt="Current photo" class="w-full h-full object-cover" crossorigin="anonymous" onerror="this.onerror=null; this.parentElement.innerHTML='<div class=\\'flex items-center justify-center h-full text-6xl\\'>ğŸ“š</div>';" />
                      </div>
                      <p class="font-bold" style="font-size: ${baseSize * 0.875}px; color: #94a3b8;">á€œá€€á€ºá€›á€¾á€­ á€•á€¯á€¶ (Current Photo)</p>
                      <p class="mt-1" style="font-size: ${baseSize * 0.75}px; color: #94a3b8;">á€¡á€á€…á€ºá€›á€½á€±á€¸á€›á€„á€º á€¡á€…á€¬á€¸á€‘á€­á€¯á€¸á€™á€šá€º</p>
                    </div>
                  ` : `
                    <div class="mt-3 p-4 rounded-2xl" style="background: rgba(255,255,255,0.05);">
                      <p style="font-size: ${baseSize * 0.8125}px; color: #94a3b8;">
                        ğŸ’¡ Photo á€™á€›á€½á€±á€¸á€›á€„á€º default icon á€á€¯á€¶á€¸á€™á€šá€º
                      </p>
                    </div>
                  `}
                </div>
                
                <div class="flex items-center gap-3 p-4 rounded-2xl" style="background: rgba(255,255,255,0.05);">
                  <input type="checkbox" id="courseIsVIP" ${editCourse?.isVIP ? 'checked' : ''} class="w-6 h-6" style="accent-color: #667eea;" />
                  <label for="courseIsVIP" class="font-bold" style="font-size: ${baseSize}px; color: #e2e8f0;">
                    ğŸŒ¸ VIP Only Course
                  </label>
                </div>
                
                <button type="submit" class="w-full p-4 rounded-2xl font-bold text-white btn-primary" style="font-size: ${baseSize * 1.125}px;">
                  ${editCourse ? 'âœï¸ Update Course' : 'â• Add Course'}
                </button>
              </form>
            </div>
          </div>
        </div>
      `;
    }

    function renderAddVideoModal() {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;
      
      const editVideo = appState.editingVideo ? allVideos.find(v => v.id === appState.editingVideo) : null;
      
      return `
        <div class="modal-backdrop" onclick="if(event.target === this) window.closeModal()">
          <div class="modal-content" style="font-family: ${customFont}, ${baseFontStack};">
            <div class="p-8">
              <div class="flex items-center justify-between mb-6">
                <h2 class="font-bold" style="font-size: ${baseSize * 1.5}px; color: #e2e8f0;">
                  ${editVideo ? 'âœï¸ Edit Video' : 'ğŸ¬ Add New Video'}
                </h2>
                <button onclick="window.closeModal()" class="w-10 h-10 rounded-full flex items-center justify-center" style="background: rgba(255,255,255,0.1); color: #94a3b8; font-size: 24px;">Ã—</button>
              </div>
              
              <form id="addVideoForm" class="space-y-5">
                <div>
                  <label class="block mb-2 font-bold" style="font-size: ${baseSize * 0.875}px; color: #94a3b8;">
                    Course
                  </label>
                  <select id="videoCourse" required class="w-full p-4 rounded-2xl border-2" style="font-size: ${baseSize}px; border-color: rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e2e8f0;">
                    <option value="">Select a course</option>
                    ${allCourses.map(course => `
                      <option value="${course.id}" ${editVideo?.courseId === course.id ? 'selected' : ''}>
                        ${course.title}
                      </option>
                    `).join('')}
                  </select>
                </div>
                
                <div>
                  <label class="block mb-2 font-bold" style="font-size: ${baseSize * 0.875}px; color: #94a3b8;">
                    Title (English)
                  </label>
                  <input type="text" id="videoTitle" required class="w-full p-4 rounded-2xl border-2" style="font-size: ${baseSize}px; border-color: rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e2e8f0;" value="${editVideo?.title || ''}" />
                </div>
                
                <div>
                  <label class="block mb-2 font-bold" style="font-size: ${baseSize * 0.875}px; color: #94a3b8;">
                    Title (Myanmar)
                  </label>
                  <input type="text" id="videoTitleMM" required class="w-full p-4 rounded-2xl border-2" style="font-size: ${baseSize}px; border-color: rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e2e8f0;" value="${editVideo?.titleMM || ''}" />
                </div>
                
                <div>
                  <label class="block mb-2 font-bold" style="font-size: ${baseSize * 0.875}px; color: #94a3b8;">
                    Duration (e.g., 15 min)
                  </label>
                  <input type="text" id="videoDuration" required class="w-full p-4 rounded-2xl border-2" style="font-size: ${baseSize}px; border-color: rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e2e8f0;" value="${editVideo?.duration || ''}" placeholder="15 min" />
                </div>
                
                <div>
                  <label class="block mb-2 font-bold" style="font-size: ${baseSize * 0.875}px; color: #94a3b8;">
                    Video File (Optional - can add later)
                  </label>
                  <input type="file" id="videoFile" accept="video/*" class="w-full p-4 rounded-2xl border-2" style="font-size: ${baseSize}px; border-color: rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e2e8f0;" />
                  ${editVideo?.videoUrl ? `
                    <div class="mt-2 p-3 rounded-xl" style="background: rgba(255,255,255,0.05);">
                      <p style="font-size: ${baseSize * 0.8125}px; color: #94a3b8;">
                        ğŸ“¹ Current video: ${editVideo.videoUrl.substring(0, 40)}...
                      </p>
                    </div>
                  ` : ''}
                  <p class="mt-2" style="font-size: ${baseSize * 0.75}px; color: #94a3b8;">
                    ğŸ’¡ You can create the video entry first and upload the video file later by editing
                  </p>
                </div>
                
                <div class="flex items-center gap-3 p-4 rounded-2xl" style="background: rgba(255,255,255,0.05);">
                  <input type="checkbox" id="videoIsVIP" ${editVideo?.isVIP ? 'checked' : ''} class="w-6 h-6" style="accent-color: #667eea;" />
                  <label for="videoIsVIP" class="font-bold" style="font-size: ${baseSize}px; color: #e2e8f0;">
                    ğŸŒ¸ VIP Only Video
                  </label>
                </div>
                
                <button type="submit" class="w-full p-4 rounded-2xl font-bold text-white btn-primary" style="font-size: ${baseSize * 1.125}px;" ${appState.isLoading ? 'disabled' : ''}>
                  ${appState.isLoading ? 'â³ Uploading...' : editVideo ? 'âœï¸ Update Video' : 'ğŸ¬ Add Video'}
                </button>
                ${appState.isLoading ? `
                  <div class="text-center mt-3">
                    <p style="font-size: ${baseSize * 0.875}px; color: #94a3b8;">
                      Please wait while uploading video file...
                    </p>
                  </div>
                ` : ''}
              </form>
            </div>
          </div>
        </div>
      `;
    }

    // ============================================
    // GLOBAL WINDOW FUNCTIONS
    // ============================================
    window.navigateTo = (page) => {
      appState.currentPage = page;
      pushHistoryState(page);
      render();
    };

    window.goBack = () => {
      history.back();
    };

    window.selectCourse = (courseId) => {
      const course = allCourses.find(c => c.id === courseId);
      const role = getUserRole();
      
      if (course.isVIP && role === 'user') {
        appState.currentPage = 'vipkey';
        pushHistoryState('vipkey');
        render();
        return;
      }
      
      appState.selectedCourse = courseId;
      appState.currentPage = 'coursedetail';
      pushHistoryState('coursedetail', { selectedCourse: courseId });
      render();
    };

    window.selectVideo = (videoId) => {
      appState.selectedVideo = videoId;
      appState.currentPage = 'videoplayer';
      pushHistoryState('videoplayer', { selectedCourse: appState.selectedCourse, selectedVideo: videoId });
      render();
    };

    window.showRegister = () => {
      appState.currentPage = 'register';
      pushHistoryState('register');
      render();
    };

    window.showLogin = () => {
      appState.currentPage = 'login';
      pushHistoryState('login');
      render();
    };

    window.showAdminLogin = () => {
      appState.showAdminLoginModal = true;
      render();
    };

    window.showLogoutConfirm = () => {
      appState.showLogoutModal = true;
      render();
    };

    window.showUserProfile = () => {
      appState.showUserProfile = true;
      render();
    };

    window.showAdminProfile = () => {
      appState.showAdminProfile = true;
      render();
    };

    window.showKeyManagement = () => {
      appState.showKeyManagement = true;
      appState.keyFilter = 'all';
      render();
    };

    window.showUserManagement = () => {
      appState.showUserManagement = true;
      render();
    };

    window.showAddCourseModal = () => {
      appState.showAddCourse = true;
      appState.editingCourse = null;
      render();
    };

    window.showAddVideoModal = () => {
      appState.showAddVideo = true;
      appState.editingVideo = null;
      render();
    };

    window.closeModal = () => {
      appState.showAdminLoginModal = false;
      appState.showLogoutModal = false;
      appState.showUserProfile = false;
      appState.showAdminProfile = false;
      appState.showKeyManagement = false;
      appState.showUserManagement = false;
      appState.showAddCourse = false;
      appState.showAddVideo = false;
      appState.editingCourse = null;
      appState.editingVideo = null;
      render();
    };

    window.confirmLogout = () => {
      handleLogout();
      window.closeModal();
    };

    window.generateKey = (duration) => {
      handleGenerateVipKey(duration);
    };

    window.filterKeys = (filter) => {
      appState.keyFilter = filter;
      render();
    };

    window.toggleLanguage = () => {
      appState.language = appState.language === 'en' ? 'mm' : 'en';
      render();
    };

    window.grantVIP = async (userId) => {
      await db.ref(`users/${userId}`).update({
        role: 'vip',
        vipActivatedAt: Date.now()
      });
      showToast('âœ¨ VIP granted successfully!');
      render();
    };

    window.revokeVIP = async (userId) => {
      await db.ref(`users/${userId}`).update({
        role: 'user',
        vipActivatedAt: null
      });
      showToast('âŒ VIP revoked');
      render();
    };

    window.editCourse = (courseId) => {
      appState.editingCourse = courseId;
      appState.showAddCourse = true;
      render();
    };

    window.deleteCourse = async (courseId) => {
      await db.ref(`courses/${courseId}`).remove();
      const videosToDelete = allVideos.filter(v => v.courseId === courseId);
      for (const video of videosToDelete) {
        await db.ref(`videos/${video.id}`).remove();
      }
      showToast('ğŸ—‘ï¸ Course deleted');
    };

    window.editVideo = (videoId) => {
      appState.editingVideo = videoId;
      appState.showAddVideo = true;
      render();
    };

    window.deleteVideo = async (videoId) => {
      await db.ref(`videos/${videoId}`).remove();
      showToast('ğŸ—‘ï¸ Video deleted');
    };

    // ============================================
    // RENDER FUNCTION
    // ============================================
    function render() {
      const app = document.getElementById('app');
      let html = '';
      let modalHtml = '';

      if (!appState.currentUser) {
        if (appState.currentPage === 'register') {
          html = renderRegisterPage();
        } else {
          html = renderLoginPage();
        }
        
        if (appState.showAdminLoginModal) {
          modalHtml = renderAdminLoginModal();
        }
      } else {
        switch (appState.currentPage) {
          case 'courses':
            html = renderCoursesPage();
            break;
          case 'coursedetail':
            html = renderCourseDetailPage();
            break;
          case 'videoplayer':
            html = renderVideoPlayerPage();
            break;
          case 'vipkey':
            html = renderVipKeyPage();
            break;
          case 'admin':
            html = renderAdminPage();
            break;
          default:
            html = renderCoursesPage();
        }
        
        // Add modals
        if (appState.showLogoutModal) {
          modalHtml = renderLogoutModal();
        } else if (appState.showUserProfile) {
          modalHtml = renderUserProfileModal();
        } else if (appState.showAdminProfile) {
          modalHtml = renderUserProfileModal();
        } else if (appState.showKeyManagement) {
          modalHtml = renderKeyManagementModal();
        } else if (appState.showUserManagement) {
          modalHtml = renderUserManagementModal();
        } else if (appState.showAddCourse) {
          modalHtml = renderAddCourseModal();
        } else if (appState.showAddVideo) {
          modalHtml = renderAddVideoModal();
        }
      }

      app.innerHTML = html + modalHtml;
      attachEventListeners();
    }

    // ============================================
    // EVENT LISTENERS
    // ============================================
    function attachEventListeners() {
      const loginForm = document.getElementById('loginForm');
      if (loginForm) {
        loginForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const email = document.getElementById('loginEmail').value;
          const password = document.getElementById('loginPassword').value;
          handleLogin(email, password);
        });
      }

      const registerForm = document.getElementById('registerForm');
      if (registerForm) {
        registerForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const name = document.getElementById('registerName').value;
          const email = document.getElementById('registerEmail').value;
          const password = document.getElementById('registerPassword').value;
          handleRegister(email, password, name);
        });
      }

      const adminLoginForm = document.getElementById('adminLoginForm');
      if (adminLoginForm) {
        adminLoginForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const password = document.getElementById('adminPassword').value;
          handleAdminLogin(password);
        });
      }

      const vipKeyForm = document.getElementById('vipKeyForm');
      if (vipKeyForm) {
        vipKeyForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const keyCode = document.getElementById('vipKeyInput').value.trim().toUpperCase();
          handleActivateVipKey(keyCode);
        });
      }

      const addCourseForm = document.getElementById('addCourseForm');
      if (addCourseForm) {
        addCourseForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          appState.isLoading = true;
          render();
          
          const title = document.getElementById('courseTitle').value;
          const titleMM = document.getElementById('courseTitleMM').value;
          const description = document.getElementById('courseDescription').value;
          const descriptionMM = document.getElementById('courseDescriptionMM').value;
          const isVIP = document.getElementById('courseIsVIP').checked;
          
          let thumbnail = 'ğŸ“š';
          let thumbnailUrl = '';
          
          // Handle photo upload
          const photoFile = document.getElementById('courseThumbnailPhoto').files[0];
          if (photoFile) {
            try {
              showToast('ğŸ“¤ á€•á€¯á€¶ á€á€„á€ºá€”á€±á€á€Šá€º...');
              const timestamp = Date.now();
              const fileName = `course_thumbnails/${timestamp}_${photoFile.name}`;
              const storageRef = storage.ref(fileName);
              
              await storageRef.put(photoFile);
              thumbnailUrl = await storageRef.getDownloadURL();
              thumbnail = '';
              showToast('âœ… á€•á€¯á€¶á€á€„á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®!');
            } catch (error) {
              console.error('Photo upload error:', error);
              showToast('âŒ á€•á€¯á€¶á€á€„á€ºá€™á€›á€•á€«: ' + error.message);
              appState.isLoading = false;
              render();
              return;
            }
          } else if (appState.editingCourse) {
            // Keep existing photo if editing and no new file
            const existingCourse = allCourses.find(c => c.id === appState.editingCourse);
            thumbnailUrl = existingCourse?.thumbnailUrl || '';
            thumbnail = existingCourse?.thumbnail || 'ğŸ“š';
          }
          
          const courseData = {
            title,
            titleMM,
            description,
            descriptionMM,
            thumbnail,
            thumbnailUrl,
            isVIP,
            createdAt: Date.now()
          };
          
          try {
            if (appState.editingCourse) {
              await db.ref(`courses/${appState.editingCourse}`).update(courseData);
              showToast('âœï¸ Course updated!');
            } else {
              await db.ref('courses').push(courseData);
              showToast('âœ¨ Course added!');
            }
            
            appState.isLoading = false;
            window.closeModal();
          } catch (error) {
            console.error('Database error:', error);
            showToast('âŒ Failed to save course');
            appState.isLoading = false;
            render();
          }
        });
      }

      const addVideoForm = document.getElementById('addVideoForm');
      if (addVideoForm) {
        addVideoForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          const courseId = document.getElementById('videoCourse').value;
          const title = document.getElementById('videoTitle').value;
          const titleMM = document.getElementById('videoTitleMM').value;
          const duration = document.getElementById('videoDuration').value;
          const isVIP = document.getElementById('videoIsVIP').checked;
          const videoFile = document.getElementById('videoFile').files[0];
          
          // Validate course selection
          if (!courseId) {
            showToast('âŒ Please select a course');
            return;
          }
          
          let videoUrl = '';
          
          // Upload video file if provided
          if (videoFile) {
            appState.isLoading = true;
            render();
            
            try {
              showToast('ğŸ“¤ Uploading video... Please wait');
              const timestamp = Date.now();
              const fileName = `videos/${timestamp}_${videoFile.name}`;
              const storageRef = storage.ref(fileName);
              
              // Upload file
              const uploadTask = storageRef.put(videoFile);
              
              // Wait for upload to complete
              await new Promise((resolve, reject) => {
                uploadTask.on('state_changed',
                  (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    console.log('Upload progress: ' + progress + '%');
                  },
                  (error) => {
                    console.error('Upload error:', error);
                    reject(error);
                  },
                  async () => {
                    try {
                      videoUrl = await uploadTask.snapshot.ref.getDownloadURL();
                      resolve();
                    } catch (err) {
                      reject(err);
                    }
                  }
                );
              });
              
              showToast('âœ… Video uploaded successfully!');
            } catch (error) {
              console.error('Upload error:', error);
              showToast('âŒ Video upload failed: ' + error.message);
              appState.isLoading = false;
              render();
              return;
            }
          } else if (appState.editingVideo) {
            // Keep existing video URL if editing and no new file
            const existingVideo = allVideos.find(v => v.id === appState.editingVideo);
            videoUrl = existingVideo?.videoUrl || '';
          } else {
            // New video without file - set empty URL
            videoUrl = '';
          }
          
          const videoData = {
            courseId,
            title,
            titleMM,
            duration,
            videoUrl,
            isVIP,
            createdAt: Date.now()
          };
          
          try {
            if (appState.editingVideo) {
              await db.ref(`videos/${appState.editingVideo}`).update(videoData);
              showToast('âœï¸ Video updated!');
            } else {
              await db.ref('videos').push(videoData);
              showToast('âœ¨ Video added!');
            }
            
            appState.isLoading = false;
            window.closeModal();
          } catch (error) {
            console.error('Database error:', error);
            showToast('âŒ Failed to save video');
            appState.isLoading = false;
            render();
          }
        });
      }
    }

    // ============================================
    // INITIALIZE
    // ============================================
    // Set initial history state
    pushHistoryState('login');
    render();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b306992678e8954',t:'MTc2NjU4MjU5Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>